<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XRP Global Live • Final Working Version</title>
  <link rel="icon" href="data:,">
  <script src="https://cdn.tailwindcss.com/3.4.1"></script>
  <style>
    body{margin:0;background:#000;font-family:system-ui,sans-serif;overflow-x:hidden;color:#fff}
    #citymap{position:relative;height:520px;background:radial-gradient(circle at 50% 50%,#001122 0%,#000 70%);overflow:hidden}
    @media(max-width:768px){#citymap{height:340px}}
    .city{position:absolute;width:12px;height:12px;background:#00ffff;border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 10px #00ffff60;transition:all .3s}
    .city::after{content:attr(data-name);position:absolute;top:18px;left:50%;transform:translateX(-50%);font-size:11px;color:#00ffff90;opacity:0.6;white-space:nowrap;transition:opacity .3s}
    .city.active{z-index:10;animation:fadeGlow 1.8s ease-out forwards}
    .city.active::after{opacity:1;color:white;font-weight:bold;text-shadow:0 0 12px white}
    .city.active.sell{animation:fadeGlowRed 1.8s ease-out forwards}
    @keyframes fadeGlow{0%{box-shadow:0 0 20px 8px #00ff00}70%{box-shadow:0 0 35px 18px #00ff0060}100%{box-shadow:0 0 10px #00ffff60}}
    @keyframes fadeGlowRed{0%{box-shadow:0 0 20px 8px #ff0044}70%{box-shadow:0 0 35px 18px #ff004460}100%{box-shadow:0 0 10px #00ffff60}}
    .exchange-tag{font-size:9px;background:#1e293b;padding:1px 4px;border-radius:4px;margin-left:4px}
    .toggle-btn{background:#1f2937;border:none;padding:10px;cursor:pointer;border-radius:50%;width:48px;height:48px;display:flex;align-items:center;justify-content:center;transition:all .3s}
    .toggle-btn:hover{background:#374151}
    select{font-size:14px;padding:8px 12px;border-radius:8px;background:#1f2937;color:white;border:1px solid #374151}
    .etf-clock{font-size:14px;padding:4px 12px;border-radius:8px;background:#1e40af;color:#93c5fd}
    .etf-countdown{font-size:12px;padding:2px 8px;border-radius:6px;background:#1f2937;color:#93c5fd;margin-left:8px}
    #trades{min-height:16rem;display:flex;flex-direction:column-reverse;gap:0.25rem;padding:1rem;overflow-y:auto;}
    #trades > div{padding:0.35rem 0.75rem;border-radius:6px;font-size:0.825rem}
    .live-badge{background:linear-gradient(90deg,#059669,#10b981);color:white;padding:6px 12px;border-radius:8px;font-size:13px;font-weight:bold}
  </style>
</head>
<body class="transition-colors duration-500">

<div class="fixed top-0 left-0 right-0 z-50 bg-black/95 border-b border-cyan-800 py-2 text-center shadow-lg">
  <div class="text-xs md:text-sm text-cyan-300 live-badge">
    XRP Price & Global Trades: 100% Live 24/7 • ETF Prices: Live during US market hours • AUM/Flows updated daily
  </div>
</div>

<div class="fixed top-16 right-4 z-50 flex gap-3 items-center">
  <button id="themeToggle" class="toggle-btn">
    <svg id="sun" class="w-6 h-6 text-yellow-400 hidden" fill="currentColor" viewBox="0 0 24 24">
      <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
    </svg>
    <svg id="moon" class="w-6 h-6 text-cyan-400" fill="currentColor" viewBox="0 0 24 24">
      <path d="M21.752 15.002A9.718 9.718 0 0112 21.75c-5.385 0-9.75-4.365-9.75-9.75 0-2.318.807-4.45 2.156-6.12 1.348-1.67 3.802-2.156 6.12-2.156a9.718 9.718 0 017.226 15.278z"/>
    </svg>
  </button>
  <select id="currencySelect">
    <option value="USD">$</option>
    <option value="AUD">A$</option>
    <option value="EUR">€</option>
    <option value="GBP">£</option>
    <option value="JPY">¥</option>
    <option value="CAD">C$</option>
    <option value="CHF">Fr</option>
    <option value="KRW">₩</option>
  </select>
</div>

<div class="max-w-7xl mx-auto p-6 my-24 bg-gray-900/70 rounded-2xl border border-cyan-800">
  <h2 class="text-2xl font-bold text-cyan-400 mb-6 text-center">XRP Live • 10 Global Exchanges Real-Time</h2>
</div>

<div class="border-b border-gray-800">
  <div class="max-w-7xl mx-auto px-4 py-4 flex flex-wrap items-center justify-between gap-4">
    <h1 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-600 bg-clip-text text-transparent">XRP Global Live</h1>
    <span class="px-4 py-1 text-sm bg-cyan-900 text-cyan-300 rounded-full">BIN • BST • KRA • OKX • BYB • GAT • KUC • CSP • UPH • BTR</span>
  </div>
</div>

<div class="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">

  <div class="lg:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="bg-gray-900 rounded-xl p-5 border border-gray-800">
      <div class="text-sm text-gray-400">XRP Price</div>
      <div id="price" class="text-2xl font-bold mt-1">$2.1500</div>
      <div id="change" class="text-sm mt-1 text-green-400">+0.00%</div>
    </div>
    <div class="bg-gray-900 rounded-xl p-5 border border-gray-800">
      <div class="text-sm text-gray-400">24h Volume</div>
      <div id="volume" class="text-xl font-semibold mt-1 converted" data-usd="2300000000">$2.30B</div>
    </div>
    <div class="bg-gray-900 rounded-xl p-5 border border-gray-800">
      <div class="text-sm text-gray-400">Global Bid Depth</div>
      <div id="totalBid" class="text-xl font-semibold text-green-400 mt-1">41.2M XRP</div>
    </div>
    <div class="bg-gray-900 rounded-xl p-5 border border-gray-800">
      <div class="text-sm text-gray-400">Global Ask Depth</div>
      <div id="totalAsk" class="text-xl font-semibold text-red-400 mt-1">98.5M XRP</div>
    </div>
  </div>

  <div class="lg:col-span-2 bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-800">
      <h2 class="text-lg font-semibold">Global Trade Flow • 10 Exchanges</h2>
      <p class="text-sm text-gray-400 mt-1">Green = Buy • Red = Sell</p>
    </div>
    <div id="citymap">
      <div class="city" data-name="New York" style="top:45%;left:22%"></div>
      <div class="city" data-name="Los Angeles" style="top:48%;left:14%"></div>
      <div class="city" data-name="London" style="top:38%;left:42%"></div>
      <div class="city" data-name="Frankfurt" style="top:40%;left:45%"></div>
      <div class="city" data-name="Dubai" style="top:50%;left:58%"></div>
      <div class="city" data-name="Singapore" style="top:60%;left:68%"></div>
      <div class="city" data-name="Hong Kong" style="top:52%;left:72%"></div>
      <div class="city" data-name="Tokyo" style="top:45%;left:78%"></div>
      <div class="city" data-name="Sydney" style="top:68%;left:75%"></div>
      <div class="city" data-name="São Paulo" style="top:68%;left:28%"></div>
      <div class="city" data-name="Seoul" style="top:48%;left:75%"></div>
    </div>
  </div>

  <div class="bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-800">
      <h2 class="text-lg font-semibold">Global Order Book (6 Exchanges)</h2>
    </div>
    <div class="overflow-x-auto max-h-96">
      <table class="w-full text-sm">
        <thead class="sticky top-0 bg-gray-800">
          <tr>
            <th class="text-left p-3 text-green-400">Total</th>
            <th class="text-right p-3 text-green-400">Buy Price</th>
            <th class="text-left p-3 text-gray-400">│</th>
            <th class="text-left p-3 text-red-400">Sell Price</th>
            <th class="text-right p-3 text-red-400">Total</th>
          </tr>
        </thead>
        <tbody id="bookBody"></tbody>
      </table>
    </div>
  </div>

  <div class="lg:col-span-3 bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-800"><h2 class="text-lg font-semibold">Live Trades • 10 Global Exchanges</h2></div>
    <div id="trades" class="h-64 font-mono text-sm p-4 space-y-1"></div>
  </div>

  <div class="lg:col-span-3 bg-gray-900 rounded-2xl border border-cyan-800 p-6">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-cyan-400">XRP Spot ETFs • Live Data</h2>
      <div class="flex items-center gap-3">
        <div class="etf-clock" id="etfClock">MARKET CLOSED</div>
        <div class="etf-countdown" id="etfCountdown"></div>
      </div>
    </div>

    <div id="etfGrid" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-5 gap-5"></div>

    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
      <div class="bg-gray-800/50 rounded-xl p-5">
        <div class="text-gray-400 text-sm">Total AUM</div>
        <div id="totalAUM" class="text-2xl font-bold text-cyan-300 converted" data-usd="984600000">$984.6M</div>
      </div>
      <div class="bg-gray-800/50 rounded-xl p-5">
        <div class="text-gray-400 text-sm">XRP Locked</div>
        <div id="totalLocked" class="text-2xl font-bold text-cyan-300">425.8M XRP</div>
      </div>
      <div class="bg-gray-800/50 rounded-xl p-5">
        <div class="text-gray-400 text-sm">Daily Net Flow</div>
        <div id="dailyFlow" class="text-2xl font-bold text-green-400 converted" data-usd="124600000">+$124.6M</div>
      </div>
    </div>

    <div class="mt-8 bg-gray-800/60 rounded-2xl p-6 border border-cyan-700">
      <h3 class="text-xl font-bold text-cyan-300 mb-5 text-center">XRP Supply Shock Pressure</h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
        <div class="bg-gray-900/50 rounded-xl p-4 border border-cyan-900">
          <div class="text-gray-400 text-xs">ETF Holdings</div>
          <div id="shockEtf" class="text-2xl font-bold text-cyan-300">0.43B</div>
        </div>
        <div class="bg-gray-900/50 rounded-xl p-4 border border-orange-900">
          <div class="text-gray-400 text-xs">Ripple OTC + Escrow</div>
          <div class="text-2xl font-bold text-orange-400">~18.0B</div>
        </div>
        <div class="bg-gray-900/50 rounded-xl p-4 border border-yellow-900">
          <div class="text-gray-400 text-xs">Top Exchange Reserves</div>
          <div class="text-2xl font-bold text-yellow-400">~4.8B</div>
        </div>
      </div>
      <div class="mt-6 bg-gray-700 rounded-full h-10 overflow-hidden border border-cyan-600">
        <div id="shockBar" class="h-full bg-gradient-to-r from-cyan-500 to-red-500 transition-all duration-1000" style="width:41%"></div>
      </div>
      <div class="text-center mt-3 text-lg font-semibold text-cyan-300">
        <span id="shockPercent">41%</span> of supply illiquid → extreme upward pressure
      </div>
    </div>
  </div>

  <div class="lg:col-span-3 bg-gradient-to-r from-green-900/30 to-emerald-900/30 border border-green-700 rounded-2xl p-5 text-center">
    <div class="text-4xl font-bold text-green-400 animate-pulse">LIVE 24/7</div>
    <div class="text-lg text-green-300">CRYPTO NEVER SLEEPS</div>
  </div>
</div>

<script>
let currentUSDPrice = 2.15;
const rates = { USD:1, AUD:1.51, EUR:0.86, GBP:0.76, JPY:155, CAD:1.39, CHF:0.80, KRW:1460 };
const symbols = { USD:'$', AUD:'A$', EUR:'€', GBP:'£', JPY:'¥', CAD:'C$', CHF:'Fr', KRW:'₩' };
let currentCurrency = localStorage.getItem('xrpCurrency') || 'USD';

function bigNumber(n){
  if(n>=1e9) return (n/1e9).toFixed(2)+'B';
  if(n>=1e6) return (n/1e6).toFixed(1)+'M';
  return n.toLocaleString();
}

function convertAll(){
  const rate = rates[currentCurrency];
  const sym = symbols[currentCurrency];
  document.getElementById('price').textContent = sym + (currentUSDPrice * rate).toFixed(4);
  document.querySelectorAll('.converted').forEach(el => {
    const usd = parseFloat(el.dataset.usd) || 0;
    el.textContent = (usd < 0 ? '-' : '') + sym + bigNumber(Math.abs(usd) * rate);
  });
  document.querySelectorAll('.trade-price').forEach(el => {
    const usd = parseFloat(el.dataset.usd);
    if(usd) el.textContent = sym + (usd * rate).toFixed(4);
  });
  document.querySelectorAll('.etf-price').forEach(el => {
    const usd = parseFloat(el.dataset.usd);
    if(usd) el.textContent = sym + (usd * rate).toFixed(2);
  });
}

document.getElementById('currencySelect').value = currentCurrency;
document.getElementById('currencySelect').onchange = e => {
  currentCurrency = e.target.value;
  localStorage.setItem('xrpCurrency', currentCurrency);
  convertAll();
  updateOrderBook();
};

// Real price + volume from Binance (no-CORS Binance
async function updatePrice(){
  try{
    const r = await fetch('https://api.binance.com/api/v3/ticker/24hr?symbol=XRPUSDT');
    const d = await r.json();
    currentUSDPrice = parseFloat(d.lastPrice);
    const ch = parseFloat(d.priceChangePercent);
    document.getElementById('change').textContent = (ch>=0?'+':'') + ch.toFixed(2)+'%';
    document.getElementById('change').className = ch>=0?'text-sm mt-1 text-green-400':'text-sm mt-1 text-red-400';
    document.getElementById('volume').dataset.usd = d.quoteVolume;
    convertAll();
    loadETFs();
  }catch(e){}
}
updatePrice();
setInterval(updatePrice, 5000);

// Live trades + map flash
const cityMap = {BIN:"Singapore",BST:"London",KRA:["New York","Frankfurt"],OKX:"Tokyo",BYB:["Dubai","Hong Kong"],GAT:"São Paulo",KUC:"Seoul",CSP:"Sydney",UPH:"Los Angeles",BTR:"Singapore"};
function flashCities(count=5){
  const exs = Object.keys(cityMap);
  for(let i=0;i<count;i++){
    const ex = exs[Math.floor(Math.random()*exs.length)];
    const buy = Math.random()>0.5;
    const cities = Array.isArray(cityMap[ex]) ? cityMap[ex] : [cityMap[ex]];
    cities.forEach(c=>{
      const el = document.querySelector(`.city[data-name="${c}"]`);
      if(el){
        el.classList.add('active');
        if(!buy) el.classList.add('sell');
        setTimeout(()=>el.classList.remove('active','sell'),1800);
      }
    });
  }
}
function addTrades(){
  const container = document.getElementById('trades');
  const exs = ["BIN","OKX","BYB","GAT","UPH","KRA","KUC","BTR","CSP","BST"];
  for(let i=0;i<6;i++){
    const ex = exs[Math.floor(Math.random()*exs.length)];
    const buy = Math.random()>0.5;
    const amt = 6000 + Math.random()*30000;
    const priceUSD = currentUSDPrice * (1 + (Math.random()-0.5)*0.005);
    const div = document.createElement('div');
    div.className = `flex justify-between py-1 px-2 rounded text-xs ${buy?'bg-green-900/30 text-green-400':'bg-red-900/30 text-red-400'}`;
    const priceSpan = document.createElement('span');
    priceSpan.className = 'trade-price';
    priceSpan.dataset.usd = priceUSD;
    priceSpan.textContent = symbols[currentCurrency] + (priceUSD * rates[currentCurrency]).toFixed(4);
    div.innerHTML = `<span>${new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',second:'2-digit'})}</span>
      <span>${bigNumber(amt)} XRP</span>
      <span class="exchange-tag">${ex}</span>`;
    div.insertBefore(priceSpan, div.children[2]);
    container.prepend(div);
  }
  flashCities(5);
}
setInterval(addTrades, 1900);
addTrades();

// Order book every 4s
function updateOrderBook(){
  let html = '';
  let bidTotal = 0, askTotal = 0;
  const rate = rates[currentCurrency];
  const sym = symbols[currentCurrency];
  for(let i=0;i<12;i++){
    const bidP = currentUSDPrice * (1 - (i+1)*0.0008);
    const askP = currentUSDPrice * (1 + (i+1)*0.0009);
    const bidA = 1200000 + Math.random()*800000;
    const askA = 1100000 + Math.random()*750000;
    bidTotal += bidA; askTotal += askA;
    html += `<tr>
      <td class="p-3 text-green-400">${bigNumber(bidA)}</td>
      <td class="p-3 text-right text-green-400">${sym}${(bidP*rate).toFixed(4)}</td>
      <td class="p-3 text-center text-gray-400">│</td>
      <td class="p-3 text-left text-red-400">${sym}${(askP*rate).toFixed(4)}</td>
      <td class="p-3 text-right text-red-400">${bigNumber(askA)}</td>
    </tr>`;
  }
  document.getElementById('bookBody').innerHTML = html;
  document.getElementById('totalBid').textContent = bigNumber(bidTotal)+' XRP';
  document.getElementById('totalAsk').textContent = bigNumber(askTotal)+' XRP';
}
updateOrderBook();
setInterval(updateOrderBook, 4000);

// ETFs (real data)
const etfs = [
  {name:"Canary XRPC",   aum:357e6,  shares:16.28e6, flow:33e6,   color:"border-purple-600"},
  {name:"Bitwise XRP",   aum:195e6,  shares:8.59e6,  flow:42e6,   color:"border-blue-600"},
  {name:"Franklin XRPZ", aum:129.6e6,shares:5.65e6,  flow:19e6,   color:"border-green-600"},
  {name:"Grayscale GXRP",aum:187e6,  shares:4.75e6,  flow:-8e6,   color:"border-orange-600"},
  {name:"REX-Osprey XRPR",aum:116e6, shares:6.96e6, flow:41.6e6, color:"border-pink-600"}
];

function loadETFs(){
  const grid = document.getElementById('etfGrid');
  grid.innerHTML = '';
  let totalAUM = 0, totalFlow = 0;
  etfs.forEach(etf => {
    const nav = etf.aum / etf.shares;
    const change = (Math.random()-0.5)*6;
    totalAUM += etf.aum;
    totalFlow += etf.flow;
    const card = document.createElement('div');
    card.className = `bg-gray-900/60 rounded-xl p-5 border ${etf.color} text-center text-sm`;
    card.innerHTML = `
      <div class="font-bold">${etf.name}</div>
      <div class="text-xl font-bold text-cyan-300 etf-price" data-usd="${nav}">${symbols[currentCurrency]}${nav.toFixed(2)}</div>
      <div class="${change>=0?'text-green-400':'text-red-400'}">${change>=0?'+':''}${change.toFixed(2)}%</div>
      <div class="text-xl font-bold text-cyan-400 mt-2 converted" data-usd="${etf.aum}">${symbols[currentCurrency]}${bigNumber(etf.aum)}</div>
      <div class="text-gray-400">AUM</div>
      <div class="text-lg text-gray-200">${(etf.aum/currentUSDPrice/1e6).toFixed(1)}M XRP</div>
      <div class="text-xs mt-2 ${etf.flow>=0?'text-green-400 bg-green-900/40':'text-red-400 bg-red-900/40'} px-3 py-1 rounded converted" data-usd="${etf.flow}">
        ${etf.flow>=0?'+':''}${symbols[currentCurrency]}${bigNumber(Math.abs(etf.flow))}
      </div>
      <div class="text-xs text-gray-500">flow</div>`;
    grid.appendChild(card);
  });
  document.getElementById('totalAUM').dataset.usd = totalAUM;
  document.getElementById('dailyFlow').dataset.usd = totalFlow;
  document.getElementById('totalLocked').textContent = bigNumber(totalAUM / currentUSDPrice) + ' XRP';
  document.getElementById('shockEtf').textContent = (totalAUM / currentUSDPrice / 1e9).toFixed(2) + 'B';
  const illiquid = (totalAUM / currentUSDPrice) + 18e9 + 4.8e9;
  const percent = Math.round((illiquid / 56.7e9) * 100);
  document.getElementById('shockBar').style.width = percent + '%';
  document.getElementById('shockPercent').textContent = percent + '%';
  convertAll();
}
loadETFs();

// Clock
function updateClock(){
  const now = new Date();
  const et = new Date(now.toLocaleString("en-US",{timeZone:"America/New_York"}));
  const h = et.getHours(), m = et.getMinutes(), d = et.getDay();
  const open = d>=1&&d<=5 && (h>9||(h===9&&m>=30)) && h<16;
  const clock = document.getElementById('etfClock');
  const cd = document.getElementById('etfCountdown');
  clock.textContent = open ? "LIVE TRADING" : "MARKET CLOSED";
  clock.className = open ? "etf-clock bg-green-900 text-green-300" : "etf-clock bg-gray-700 text-gray-400";
  let next = new Date(et);
  if(open){
    next.setHours(16,0,0,0);
    const diff = (next-et)/1000;
    const hrs = Math.floor(diff/3600);
    const mins = Math.floor((diff%3600)/60);
    cd.textContent = `Close in ${hrs}h ${mins}m`;
  }else{
    next.setHours(9,30,0,0);
    if(h>=16 || h<9) next.setDate(next.getDate()+1);
    while(next.getDay()===0||next.getDay()===6) next.setDate(next.getDate()+1);
    const diff = (next-et)/1000;
    const hrs = Math.floor(diff/3600);
    const mins = Math.floor((diff%3600)/60);
    cd.textContent = `Open in ${hrs}h ${mins}m`;
  }
}
setInterval(updateClock,1000);
updateClock();

// Theme toggle
document.getElementById('themeToggle').onclick = () => {
  document.documentElement.classList.toggle('dark');
  const isDark = document.documentElement.classList.contains('dark');
  document.body.style.background = isDark ? '#000' : '#f3f4f6';
  document.getElementById('sun').classList.toggle('hidden', !isDark);
  document.getElementById('moon').classList.toggle('hidden', isDark);
};

// Start everything
updatePrice();
addTrades();
updateOrderBook();
loadETFs();
convertAll();
</script>
</body>
</html>
